{"ast":null,"code":"import axios from \"axios\";\nimport qs from \"qs\";\nimport pkceChallenge from \"pkce-challenge\";\nconst AUTH_SERVER = process.env.REACT_APP_AUTH_SERVER_BASE_URL;\nconst APP_BASE_URL = process.env.REACT_APP_BASE_URL;\nconst authServer = axios.create({\n  baseURL: AUTH_SERVER\n});\nauthServer.interceptors.response.use(undefined, async error => {\n  var _error$response;\n\n  if ((error === null || error === void 0 ? void 0 : (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.status) === 401) {\n    AuthService.imperativelySendToLogout();\n  }\n\n  return Promise.reject(error);\n});\nexport default class AuthService {\n  static imperativelySendToLogout() {\n    window.localStorage.clear();\n    window.location.href = `${AUTH_SERVER}/logout?redirect=${APP_BASE_URL}`;\n  }\n\n  static async getNewToken(config) {\n    const formUrlEncoded = qs.stringify({\n      refresh_token: config.refreshToken,\n      code_verifier: config.codeVerifier,\n      scope: config.scope,\n      grant_type: \"refresh_token\",\n      client_id: \"alganews-cms\"\n    });\n    return authServer.post(\"/oauth/token\", formUrlEncoded, {\n      headers: {\n        \"Content-Type\": \"application/x-www-form-urlencoded\"\n      }\n    }).then(res => res.data);\n  }\n\n  static async getFirstAccessTokens(config) {\n    const data = {\n      code: config.code,\n      code_verifier: config.codeVerifier,\n      redirect_uri: config.redirectUri,\n      grant_type: \"authorization_code\",\n      client_id: \"alganews-cms\"\n    };\n    const encodedData = qs.stringify(data);\n    return authServer.post(\"/oauth/token\", encodedData, {\n      headers: {\n        \"Content-Type\": \"application/x-www-form-urlencoded\"\n      }\n    }).then(res => res.data);\n  }\n\n  static getLoginScreenUrl(codeChallenge) {\n    const config = qs.stringify({\n      response_type: \"code\",\n      client_id: \"alganews-cms\",\n      redirect_uri: `${window.location.origin}/authorize`,\n      code_challenge: codeChallenge,\n      code_challenge_method: \"S256\"\n    });\n    return `${AUTH_SERVER}/oauth/authorize?${config}`;\n  }\n\n  static async imperativelySendToLoginScreen() {\n    const {\n      code_challenge,\n      code_verifier\n    } = await pkceChallenge();\n    this.setCodeVerifier(code_verifier);\n    const loginUrl = this.getLoginScreenUrl(code_challenge); // imperativo\n    // gera efeito colateral\n\n    window.location.href = loginUrl;\n  }\n\n  static getAccessToken() {\n    return window.localStorage.getItem(\"accessToken\");\n  }\n\n  static setAccessToken(token) {\n    return window.localStorage.setItem(\"accessToken\", token);\n  }\n\n  static getRefreshToken() {\n    return window.localStorage.getItem(\"refreshToken\");\n  }\n\n  static setRefreshToken(token) {\n    return window.localStorage.setItem(\"refreshToken\", token);\n  }\n\n  static getCodeVerifier() {\n    return window.localStorage.getItem(\"codeVerifier\");\n  }\n\n  static setCodeVerifier(getCodeVerifier) {\n    return window.localStorage.setItem(\"codeVerifier\", getCodeVerifier);\n  }\n\n}","map":{"version":3,"sources":["D:/ReactProjetos/alganews-cms/src/auth/Authorization.service.ts"],"names":["axios","qs","pkceChallenge","AUTH_SERVER","process","env","REACT_APP_AUTH_SERVER_BASE_URL","APP_BASE_URL","REACT_APP_BASE_URL","authServer","create","baseURL","interceptors","response","use","undefined","error","status","AuthService","imperativelySendToLogout","Promise","reject","window","localStorage","clear","location","href","getNewToken","config","formUrlEncoded","stringify","refresh_token","refreshToken","code_verifier","codeVerifier","scope","grant_type","client_id","post","headers","then","res","data","getFirstAccessTokens","code","redirect_uri","redirectUri","encodedData","getLoginScreenUrl","codeChallenge","response_type","origin","code_challenge","code_challenge_method","imperativelySendToLoginScreen","setCodeVerifier","loginUrl","getAccessToken","getItem","setAccessToken","token","setItem","getRefreshToken","setRefreshToken","getCodeVerifier"],"mappings":"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","sourcesContent":["import axios from \"axios\";\nimport qs from \"qs\";\nimport pkceChallenge from \"pkce-challenge\";\n\nconst AUTH_SERVER = process.env.REACT_APP_AUTH_SERVER_BASE_URL;\nconst APP_BASE_URL = process.env.REACT_APP_BASE_URL;\n\nconst authServer = axios.create({\n  baseURL: AUTH_SERVER,\n});\n\nauthServer.interceptors.response.use(undefined, async (error) => {\n  if (error?.response?.status === 401) {\n    AuthService.imperativelySendToLogout();\n  }\n\n  return Promise.reject(error);\n});\n\nexport interface OAuthAuthorizationTokenResponse {\n  access_token: string;\n  refresh_token: string;\n  token_type: \"bearer\" | string;\n  expires_in: number;\n  scope: string;\n  [key: string]: string | number;\n}\n\nexport default class AuthService {\n  public static imperativelySendToLogout() {\n    window.localStorage.clear();\n    window.location.href = `${AUTH_SERVER}/logout?redirect=${APP_BASE_URL}`;\n  }\n\n  public static async getNewToken(config: {\n    refreshToken: string;\n    codeVerifier: string;\n    scope?: string;\n  }) {\n    const formUrlEncoded = qs.stringify({\n      refresh_token: config.refreshToken,\n      code_verifier: config.codeVerifier,\n      scope: config.scope,\n      grant_type: \"refresh_token\",\n      client_id: \"alganews-cms\",\n    });\n\n    return authServer\n      .post<OAuthAuthorizationTokenResponse>(\"/oauth/token\", formUrlEncoded, {\n        headers: {\n          \"Content-Type\": \"application/x-www-form-urlencoded\",\n        },\n      })\n      .then((res) => res.data);\n  }\n\n  public static async getFirstAccessTokens(config: {\n    code: string;\n    codeVerifier: string;\n    redirectUri: string;\n  }) {\n    const data = {\n      code: config.code,\n      code_verifier: config.codeVerifier,\n      redirect_uri: config.redirectUri,\n      grant_type: \"authorization_code\",\n      client_id: \"alganews-cms\",\n    };\n\n    const encodedData = qs.stringify(data);\n\n    return authServer\n      .post<OAuthAuthorizationTokenResponse>(\"/oauth/token\", encodedData, {\n        headers: {\n          \"Content-Type\": \"application/x-www-form-urlencoded\",\n        },\n      })\n      .then((res) => res.data);\n  }\n\n  public static getLoginScreenUrl(codeChallenge: string) {\n    const config = qs.stringify({\n      response_type: \"code\",\n      client_id: \"alganews-cms\",\n      redirect_uri: `${window.location.origin}/authorize`,\n      code_challenge: codeChallenge,\n      code_challenge_method: \"S256\",\n    });\n\n    return `${AUTH_SERVER}/oauth/authorize?${config}`;\n  }\n\n  public static async imperativelySendToLoginScreen() {\n    const { code_challenge, code_verifier } = await pkceChallenge();\n    this.setCodeVerifier(code_verifier);\n\n    const loginUrl = this.getLoginScreenUrl(code_challenge);\n\n    // imperativo\n    // gera efeito colateral\n    window.location.href = loginUrl;\n  }\n\n  public static getAccessToken() {\n    return window.localStorage.getItem(\"accessToken\");\n  }\n  public static setAccessToken(token: string) {\n    return window.localStorage.setItem(\"accessToken\", token);\n  }\n\n  public static getRefreshToken() {\n    return window.localStorage.getItem(\"refreshToken\");\n  }\n  public static setRefreshToken(token: string) {\n    return window.localStorage.setItem(\"refreshToken\", token);\n  }\n\n  public static getCodeVerifier() {\n    return window.localStorage.getItem(\"codeVerifier\");\n  }\n  public static setCodeVerifier(getCodeVerifier: string) {\n    return window.localStorage.setItem(\"codeVerifier\", getCodeVerifier);\n  }\n}\n"]},"metadata":{},"sourceType":"module"}